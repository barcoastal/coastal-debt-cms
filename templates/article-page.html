<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{META_TITLE}}</title>
  <meta name="description" content="{{META_DESCRIPTION}}">
  <meta property="og:title" content="{{META_TITLE}}">
  <meta property="og:description" content="{{META_DESCRIPTION}}">
  <meta property="og:type" content="article">
  {{HEAD_SCRIPTS}}
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Georgia, 'Times New Roman', Times, serif;
      color: #1a1a1a;
      background: #fff;
      line-height: 1.8;
      font-size: 18px;
      -webkit-font-smoothing: antialiased;
    }

    /* Masthead */
    .masthead {
      border-bottom: 1px solid #e5e5e5;
      padding: 16px 0;
      text-align: center;
    }
    .masthead-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .masthead-name {
      font-family: Georgia, serif;
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
      letter-spacing: -0.5px;
    }
    .masthead-tagline {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 2px;
    }

    /* Article container */
    .article-container {
      max-width: 720px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Category tag */
    .article-category {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #1a6dff;
      margin-top: 40px;
      margin-bottom: 16px;
    }

    /* Headline */
    .article-headline {
      font-family: Georgia, serif;
      font-size: 40px;
      font-weight: 700;
      line-height: 1.2;
      color: #1a1a1a;
      margin-bottom: 16px;
      letter-spacing: -0.5px;
    }

    /* Subheadline / deck */
    .article-subheadline {
      font-family: Georgia, serif;
      font-size: 22px;
      line-height: 1.5;
      color: #555;
      margin-bottom: 24px;
      font-weight: 400;
    }

    /* Byline */
    .article-byline {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      color: #666;
      padding-bottom: 24px;
      border-bottom: 1px solid #e5e5e5;
      margin-bottom: 32px;
    }
    .article-byline .author-name {
      font-weight: 600;
      color: #1a1a1a;
    }
    .article-byline .author-title {
      color: #888;
    }

    /* Article body */
    .article-body {
      margin-bottom: 48px;
    }
    .article-body p {
      margin-bottom: 24px;
    }
    .article-body h2 {
      font-family: Georgia, serif;
      font-size: 28px;
      font-weight: 700;
      margin-top: 40px;
      margin-bottom: 16px;
      line-height: 1.3;
      color: #1a1a1a;
    }
    .article-body h3 {
      font-family: Georgia, serif;
      font-size: 22px;
      font-weight: 700;
      margin-top: 32px;
      margin-bottom: 12px;
      line-height: 1.3;
    }
    .article-body ul, .article-body ol {
      margin-bottom: 24px;
      padding-left: 28px;
    }
    .article-body li {
      margin-bottom: 8px;
    }
    .article-body blockquote {
      border-left: 3px solid #1a6dff;
      padding-left: 20px;
      margin: 32px 0;
      font-style: italic;
      color: #444;
    }
    .article-body strong {
      font-weight: 700;
    }
    .article-body em {
      font-style: italic;
    }
    .article-body a {
      color: #1a6dff;
      text-decoration: underline;
    }

    /* Featured / hero image */
    .article-hero-img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 32px;
      aspect-ratio: 16/9;
      object-fit: cover;
    }

    /* Inline article images */
    .article-body figure {
      margin: 36px 0;
    }
    .article-body figure img {
      width: 100%;
      border-radius: 6px;
      display: block;
    }
    .article-body figure figcaption {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 13px;
      color: #888;
      margin-top: 8px;
      line-height: 1.5;
    }

    /* Pull quote / stat highlight */
    .article-stat-box {
      background: #f0f4ff;
      border-left: 4px solid #1a6dff;
      border-radius: 0 8px 8px 0;
      padding: 24px 28px;
      margin: 36px 0;
    }
    .article-stat-box .stat-number {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 36px;
      font-weight: 800;
      color: #1a6dff;
      line-height: 1.1;
    }
    .article-stat-box .stat-label {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #444;
      margin-top: 4px;
    }

    /* Inline CTA banner */
    .article-cta-banner {
      background: linear-gradient(135deg, #1a3a5c 0%, #1a2e4a 100%);
      border-radius: 8px;
      padding: 28px 32px;
      margin: 40px 0;
      text-align: center;
    }
    .article-cta-banner .cta-text {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 14px;
      line-height: 1.4;
    }
    .article-cta-banner .cta-sub {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 18px;
    }
    .article-cta-banner .cta-button {
      display: inline-block;
      padding: 14px 36px;
      background: #1a6dff;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.2s;
    }
    .article-cta-banner .cta-button:hover {
      background: #1558cc;
      color: #fff;
    }

    /* Inline text CTA link */
    .article-inline-cta {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: block;
      text-align: center;
      margin: 32px 0;
      font-size: 15px;
      font-weight: 600;
    }
    .article-inline-cta a {
      color: #1a6dff;
      text-decoration: none;
      border-bottom: 2px solid #1a6dff;
      padding-bottom: 2px;
      transition: opacity 0.2s;
    }
    .article-inline-cta a:hover {
      opacity: 0.8;
    }

    /* Trust badges row */
    .article-trust-badges {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 32px;
      margin: 36px 0;
      padding: 20px;
      background: #f9fafb;
      border-radius: 8px;
      flex-wrap: wrap;
    }
    .article-trust-badges img {
      height: 36px;
      opacity: 0.7;
      filter: grayscale(100%);
      transition: all 0.2s;
    }
    .article-trust-badges img:hover {
      opacity: 1;
      filter: grayscale(0%);
    }
    .article-trust-badges .trust-text {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    /* Benefits section */
    .article-benefits {
      margin: 40px 0;
    }
    .article-benefits-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #1a2e4a;
      text-align: center;
      margin-bottom: 28px;
    }
    .benefits-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    .benefit-card {
      background: #f0f7ff;
      border-radius: 10px;
      padding: 24px 28px;
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }
    .benefit-icon {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      background: #1a6dff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }
    .benefit-card h4 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: #1a2e4a;
      margin-bottom: 4px;
    }
    .benefit-card p {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      color: #555;
      line-height: 1.5;
      margin-bottom: 0;
    }

    /* Case studies grid */
    .case-studies-section {
      margin: 48px 0;
    }
    .case-studies-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #1a2e4a;
      text-align: center;
      margin-bottom: 8px;
    }
    .case-studies-subtitle {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #666;
      text-align: center;
      margin-bottom: 28px;
    }
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    .case-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      transition: box-shadow 0.2s;
    }
    .case-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    .case-savings {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: inline-block;
      background: #dcfce7;
      color: #15803d;
      font-size: 22px;
      font-weight: 800;
      padding: 6px 16px;
      border-radius: 20px;
      margin-bottom: 12px;
    }
    .case-company {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: #888;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .case-row {
      display: flex;
      justify-content: space-between;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      padding: 6px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    .case-row:last-child { border-bottom: none; }
    .case-row .label { color: #888; }
    .case-row .value { font-weight: 600; color: #1a2e4a; }
    .case-row .value.saved { color: #15803d; }

    /* Testimonials section */
    .testimonials-section {
      margin: 48px 0;
    }
    .testimonials-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #1a2e4a;
      text-align: center;
      margin-bottom: 28px;
    }
    .testimonials-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    .testimonial-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 24px;
    }
    .testimonial-stars {
      color: #f59e0b;
      font-size: 16px;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }
    .testimonial-text {
      font-family: Georgia, serif;
      font-size: 16px;
      line-height: 1.7;
      color: #333;
      margin-bottom: 14px;
      font-style: italic;
    }
    .testimonial-author {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: #1a2e4a;
    }
    .testimonial-date {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      color: #999;
      margin-top: 2px;
    }

    /* Process / How it works steps */
    .process-section {
      margin: 48px 0;
    }
    .process-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #1a2e4a;
      text-align: center;
      margin-bottom: 8px;
    }
    .process-subtitle {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #666;
      text-align: center;
      margin-bottom: 32px;
      max-width: 560px;
      margin-left: auto;
      margin-right: auto;
    }
    .process-steps {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .process-step {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    .step-number {
      flex-shrink: 0;
      width: 44px;
      height: 44px;
      background: #1a6dff;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 18px;
      font-weight: 700;
    }
    .step-content h4 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 17px;
      font-weight: 700;
      color: #1a2e4a;
      margin-bottom: 4px;
    }
    .step-content p {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #555;
      line-height: 1.6;
      margin-bottom: 0;
    }

    @media (max-width: 768px) {
      .article-stat-box { padding: 20px 22px; }
      .article-stat-box .stat-number { font-size: 28px; }
      .article-cta-banner { padding: 24px 20px; margin-left: -20px; margin-right: -20px; border-radius: 0; }
      .article-trust-badges { gap: 20px; }
      .article-trust-badges img { height: 28px; }
      .case-studies-grid { grid-template-columns: 1fr; }
      .case-savings { font-size: 18px; }
      .benefit-card { padding: 20px; }
    }

    /* Mid-article form callout */
    .article-form-callout {
      background: #f8f9fb;
      border: 1px solid #e0e4ea;
      border-radius: 8px;
      padding: 32px;
      margin: 40px 0;
    }
    .article-form-callout .form-callout-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 4px;
      text-align: center;
    }
    .article-form-callout .form-callout-subtitle {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      text-align: center;
    }

    /* End-of-article form */
    .article-end-form {
      background: #f8f9fb;
      border: 1px solid #e0e4ea;
      border-radius: 8px;
      padding: 40px 32px;
      margin: 48px 0 32px;
    }
    .article-end-form .form-callout-title {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 4px;
      text-align: center;
    }
    .article-end-form .form-callout-subtitle {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #666;
      margin-bottom: 24px;
      text-align: center;
    }

    /* Form styles */
    .article-form {
      max-width: 480px;
      margin: 0 auto;
    }
    .article-form .form-field {
      margin-bottom: 12px;
    }
    .article-form input[type="text"],
    .article-form input[type="email"],
    .article-form input[type="tel"] {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #1a1a1a;
      background: #fff;
      transition: border-color 0.2s;
    }
    .article-form input:focus {
      outline: none;
      border-color: #1a6dff;
      box-shadow: 0 0 0 3px rgba(26, 109, 255, 0.1);
    }
    .article-form input::placeholder {
      color: #9ca3af;
    }
    .article-form .form-submit {
      width: 100%;
      padding: 14px;
      background: #1a6dff;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 4px;
    }
    .article-form .form-submit:hover {
      background: #1558cc;
    }
    .article-form .form-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .article-form .form-consent {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 11px;
      color: #888;
      margin-top: 10px;
      text-align: center;
      line-height: 1.5;
    }
    .form-success {
      text-align: center;
      padding: 24px;
      display: none;
    }
    .form-success h3 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 20px;
      color: #16a34a;
      margin-bottom: 8px;
    }
    .form-success p {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 15px;
      color: #555;
    }

    /* Footer */
    .article-footer {
      border-top: 1px solid #e5e5e5;
      padding: 24px 0 48px;
      margin-top: 48px;
    }
    .article-disclosure {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      color: #999;
      line-height: 1.6;
      max-width: 720px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .article-disclosure strong {
      color: #777;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      body { font-size: 17px; }
      .masthead-name { font-size: 22px; }
      .article-headline { font-size: 30px; }
      .article-subheadline { font-size: 19px; }
      .article-body h2 { font-size: 24px; }
      .article-form-callout,
      .article-end-form { padding: 24px 20px; margin-left: -20px; margin-right: -20px; border-radius: 0; border-left: none; border-right: none; }
      .article-category { margin-top: 24px; }
    }

    @media (max-width: 480px) {
      .article-headline { font-size: 26px; }
      .article-subheadline { font-size: 17px; }
      .article-form-callout .form-callout-title,
      .article-end-form .form-callout-title { font-size: 18px; }
    }
  </style>
</head>
<body>
  {{BODY_SCRIPTS}}

  <!-- Masthead -->
  <header class="masthead">
    <div class="masthead-inner">
      <div class="masthead-name">National Business Report</div>
      <div class="masthead-tagline">Business &bull; Finance &bull; Economy</div>
    </div>
  </header>

  <!-- Article -->
  <article class="article-container">
    <div class="article-category">Business &amp; Finance</div>
    <h1 class="article-headline">{{HEADLINE}}</h1>
    <p class="article-subheadline">{{SUBHEADLINE}}</p>
    <div class="article-byline">
      By <span class="author-name">{{AUTHOR_NAME}}</span>, <span class="author-title">{{AUTHOR_TITLE}}</span>
      &nbsp;&bull;&nbsp; {{PUBLISH_DATE}}
    </div>

    {{HERO_IMAGE}}

    <div class="article-body">
      {{BODY_BEFORE_FORM}}

      <!-- Mid-article form -->
      <div class="article-form-callout" id="midFormSection">
        <div class="form-callout-title">{{FORM_TITLE}}</div>
        <div class="form-callout-subtitle">{{FORM_SUBTITLE}}</div>
        <form class="article-form" id="midArticleForm" onsubmit="return submitArticleForm(event, 'mid')">
          <div id="midFormFields"></div>
          {{HIDDEN_FIELDS}}
          <input type="hidden" name="article_slug" value="{{SLUG}}">
          <input type="hidden" name="eli_clickid" class="eli-field">
          <input type="hidden" name="gclid" class="gclid-field">
          <input type="hidden" name="msclkid" class="msclkid-field">
          <input type="hidden" name="fbclid" class="fbclid-field">
          <input type="hidden" name="rt_clickid" class="rt-field">
          <input type="hidden" name="page_url" class="pageurl-field">
          <input type="hidden" name="referrer_url" class="referrer-field">
          <button type="submit" class="form-submit">{{FORM_SUBMIT_TEXT}}</button>
          <div class="form-consent">By submitting, you agree to be contacted about debt relief options. Your information is secure and will never be sold.</div>
        </form>
        <div class="form-success" id="midFormSuccess">
          <h3>Thank You!</h3>
          <p>{{FORM_SUCCESS_MSG}}</p>
        </div>
      </div>

      {{BODY_AFTER_FORM}}
    </div>

    <!-- End-of-article form -->
    <div class="article-end-form" id="endFormSection">
      <div class="form-callout-title">{{END_FORM_TITLE}}</div>
      <div class="form-callout-subtitle">{{END_FORM_SUBTITLE}}</div>
      <form class="article-form" id="endArticleForm" onsubmit="return submitArticleForm(event, 'end')">
        <div id="endFormFields"></div>
        {{HIDDEN_FIELDS}}
        <input type="hidden" name="article_slug" value="{{SLUG}}">
        <input type="hidden" name="eli_clickid" class="eli-field">
        <input type="hidden" name="gclid" class="gclid-field">
        <input type="hidden" name="msclkid" class="msclkid-field">
        <input type="hidden" name="fbclid" class="fbclid-field">
        <input type="hidden" name="rt_clickid" class="rt-field">
        <input type="hidden" name="page_url" class="pageurl-field">
        <input type="hidden" name="referrer_url" class="referrer-field">
        <button type="submit" class="form-submit">{{FORM_SUBMIT_TEXT}}</button>
        <div class="form-consent">By submitting, you agree to be contacted about debt relief options. Your information is secure and will never be sold.</div>
      </form>
      <div class="form-success" id="endFormSuccess">
        <h3>Thank You!</h3>
        <p>{{FORM_SUCCESS_MSG}}</p>
      </div>
    </div>
  </article>

  <!-- Footer -->
  <footer class="article-footer">
    <div class="article-disclosure">
      <strong>Advertiser Disclosure:</strong> This article is a sponsored advertisement for debt relief services. The stories presented are based on composites of real client experiences; individual results may vary. This content is provided for informational purposes only and does not constitute financial or legal advice. Coastal Debt Resolve is a debt settlement company and is not a law firm or government agency. Consult with a qualified financial advisor before making decisions about your debt.
    </div>
  </footer>

  <script>
    // ============= Visitor Tracking (eli_clickid) =============
    const ARTICLE_SLUG = '{{SLUG}}';

    function getOrCreateVisitorId() {
      let vid = localStorage.getItem('_vid_');
      if (!vid) {
        vid = 'eli_' + Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('_vid_', vid);
      }
      return vid;
    }

    function getUrlParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name) || '';
    }

    function getGclid() {
      let gclid = getUrlParam('gclid');
      if (gclid) { localStorage.setItem('gclid', gclid); return gclid; }
      gclid = localStorage.getItem('gclid');
      if (gclid) return gclid;
      try {
        const cookies = document.cookie.split(';');
        for (const c of cookies) {
          const [name, val] = c.trim().split('=');
          if (name === '_gcl_aw' && val) {
            const parts = val.split('.');
            return parts[parts.length - 1] || '';
          }
        }
      } catch (e) {}
      return '';
    }

    function getMsclkid() {
      let v = getUrlParam('msclkid');
      if (v) { localStorage.setItem('msclkid', v); return v; }
      return localStorage.getItem('msclkid') || '';
    }

    function getFbclid() {
      let v = getUrlParam('fbclid');
      if (v) { localStorage.setItem('fbclid', v); return v; }
      return localStorage.getItem('fbclid') || '';
    }

    function getRtClickid() {
      let v = getUrlParam('rt_clickid');
      if (v) { sessionStorage.setItem('rt_clickid', v); localStorage.setItem('rt_clickid', v); return v; }
      v = sessionStorage.getItem('rt_clickid') || localStorage.getItem('rt_clickid') || '';
      if (!v) {
        try {
          const cookies = document.cookie.split(';');
          for (const c of cookies) {
            const [name, val] = c.trim().split('=');
            if (name.trim() === 'rtkclickid-store' && val) return val;
          }
        } catch (e) {}
      }
      return v;
    }

    // Set hidden fields on all forms
    function setHiddenFields() {
      const eli = getOrCreateVisitorId();
      const gclid = getGclid();
      const msclkid = getMsclkid();
      const fbclid = getFbclid();
      const rt = getRtClickid();

      document.querySelectorAll('.eli-field').forEach(f => f.value = eli);
      document.querySelectorAll('.gclid-field').forEach(f => f.value = gclid);
      document.querySelectorAll('.msclkid-field').forEach(f => f.value = msclkid);
      document.querySelectorAll('.fbclid-field').forEach(f => f.value = fbclid);
      document.querySelectorAll('.rt-field').forEach(f => f.value = rt);
      document.querySelectorAll('.pageurl-field').forEach(f => f.value = window.location.href);
      document.querySelectorAll('.referrer-field').forEach(f => f.value = document.referrer);
    }

    // Track visitor
    function trackVisitor() {
      const eli = getOrCreateVisitorId();
      const data = {
        eli_clickid: eli,
        gclid: getGclid(),
        rt_clickid: getRtClickid(),
        msclkid: getMsclkid(),
        fbclid: getFbclid(),
        landing_page: window.location.pathname,
        referrer_url: document.referrer,
        screen_width: screen.width,
        screen_height: screen.height,
        language: navigator.language,
        user_agent: navigator.userAgent,
        utm_source: getUrlParam('utm_source'),
        utm_medium: getUrlParam('utm_medium'),
        utm_campaign: getUrlParam('utm_campaign'),
        utm_term: getUrlParam('utm_term'),
        utm_content: getUrlParam('utm_content')
      };

      fetch('/api/visitors/track', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).catch(() => {});
    }

    // ============= Form Rendering =============
    const formFields = {{FORM_FIELDS_JSON}};

    function renderFormFields(containerId) {
      const container = document.getElementById(containerId);
      const visibleFields = formFields.filter(f => f.type !== 'hidden');
      container.innerHTML = visibleFields.map(f => `
        <div class="form-field">
          <input type="${f.type}" name="${f.name}" placeholder="${f.placeholder || f.label}"
                 ${f.required ? 'required' : ''}>
        </div>
      `).join('');
    }

    // ============= Form Submission =============
    async function submitArticleForm(e, formType) {
      e.preventDefault();
      const form = formType === 'mid' ? document.getElementById('midArticleForm') : document.getElementById('endArticleForm');
      const btn = form.querySelector('.form-submit');
      btn.disabled = true;
      btn.textContent = 'Submitting...';

      const formData = new FormData(form);
      const data = {};
      formData.forEach((val, key) => { data[key] = val; });

      try {
        const res = await fetch('/api/leads', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          // Show success on both forms
          document.getElementById('midArticleForm').style.display = 'none';
          document.getElementById('midFormSuccess').style.display = 'block';
          document.getElementById('endArticleForm').style.display = 'none';
          document.getElementById('endFormSuccess').style.display = 'block';

          // Fire Facebook Pixel if available
          if (typeof fbq === 'function') {
            fbq('track', 'Lead', { content_name: ARTICLE_SLUG });
          }
        } else {
          const err = await res.json();
          alert(err.error || 'Something went wrong. Please try again.');
          btn.disabled = false;
          btn.textContent = '{{FORM_SUBMIT_TEXT}}';
        }
      } catch (err) {
        alert('Network error. Please try again.');
        btn.disabled = false;
        btn.textContent = '{{FORM_SUBMIT_TEXT}}';
      }
    }

    // ============= CTA scroll to form =============
    document.querySelectorAll('.cta-button, .article-inline-cta a').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        // Use the href target if it points to a valid section, otherwise default to mid form
        const href = this.getAttribute('href');
        let target = null;
        if (href && href.startsWith('#')) {
          target = document.getElementById(href.substring(1));
        }
        if (!target) target = document.getElementById('midFormSection');
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          const firstInput = target.querySelector('input[type="text"], input[type="email"]');
          if (firstInput) setTimeout(() => firstInput.focus(), 600);
        }
      });
    });

    // ============= Init =============
    renderFormFields('midFormFields');
    renderFormFields('endFormFields');
    setHiddenFields();
    trackVisitor();

    // Retry tracking after 3s (for late-loading cookies)
    setTimeout(() => {
      setHiddenFields();
      trackVisitor();
    }, 3000);
  </script>
</body>
</html>
